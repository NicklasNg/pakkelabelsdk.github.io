window.toCountries = [{"id": "GQ", "text": "Ækvatorialguinea", "customs_declaration_required": true}, {
    "id": "AF",
    "text": "Afghanistan",
    "customs_declaration_required": true
}, {"id": "AL", "text": "Albanien", "customs_declaration_required": true}, {"id": "DZ", "text": "Algeriet", "customs_declaration_required": true}, {
    "id": "VI",
    "text": "Amerikanske Jomfruøer, De",
    "customs_declaration_required": true
}, {"id": "AS", "text": "Amerikansk Samoa", "customs_declaration_required": true}, {"id": "AD", "text": "Andorra", "customs_declaration_required": true}, {
    "id": "AO",
    "text": "Angola",
    "customs_declaration_required": true
}, {"id": "AI", "text": "Anguilla", "customs_declaration_required": true}, {"id": "AG", "text": "Antigua og Barbuda", "customs_declaration_required": true}, {
    "id": "AR",
    "text": "Argentina",
    "customs_declaration_required": true
}, {"id": "AM", "text": "Armenien", "customs_declaration_required": true}, {"id": "AW", "text": "Aruba", "customs_declaration_required": true}, {
    "id": "AZ",
    "text": "Aserbajdsjan",
    "customs_declaration_required": true
}, {"id": "AU", "text": "Australien", "customs_declaration_required": true}, {"id": "BS", "text": "Bahamas", "customs_declaration_required": true}, {
    "id": "BH",
    "text": "Bahrain",
    "customs_declaration_required": true
}, {"id": "BD", "text": "Bangladesh", "customs_declaration_required": true}, {"id": "BB", "text": "Barbados", "customs_declaration_required": true}, {
    "id": "BE",
    "text": "Belgien",
    "customs_declaration_required": false
}, {"id": "BZ", "text": "Belize", "customs_declaration_required": true}, {"id": "BJ", "text": "Benin", "customs_declaration_required": true}, {
    "id": "BM",
    "text": "Bermuda",
    "customs_declaration_required": true
}, {"id": "BT", "text": "Bhutan", "customs_declaration_required": true}, {
    "id": "BO",
    "text": "Bolivia, Den Plurinationale Stat",
    "customs_declaration_required": true
}, {"id": "BA", "text": "Bosnien-Herzegovina", "customs_declaration_required": true}, {"id": "BW", "text": "Botswana", "customs_declaration_required": true}, {
    "id": "BR",
    "text": "Brasilien",
    "customs_declaration_required": true
}, {"id": "VG", "text": "Britiske Jomfruøer, De", "customs_declaration_required": true}, {
    "id": "BN",
    "text": "Brunei",
    "customs_declaration_required": true
}, {"id": "BG", "text": "Bulgarien", "customs_declaration_required": false}, {"id": "BF", "text": "Burkina Faso", "customs_declaration_required": true}, {
    "id": "MM",
    "text": "Burma",
    "customs_declaration_required": true
}, {"id": "BI", "text": "Burundi", "customs_declaration_required": true}, {"id": "KH", "text": "Cambodja", "customs_declaration_required": true}, {
    "id": "CM",
    "text": "Cameroun",
    "customs_declaration_required": true
}, {"id": "CA", "text": "Canada", "customs_declaration_required": true}, {"id": "KY", "text": "Caymanøerne", "customs_declaration_required": true}, {
    "id": "CF",
    "text": "Centralafrikanske Republik",
    "customs_declaration_required": true
}, {"id": "CL", "text": "Chile", "customs_declaration_required": true}, {"id": "CO", "text": "Columbia", "customs_declaration_required": true}, {
    "id": "KM",
    "text": "Comorerne",
    "customs_declaration_required": true
}, {"id": "CG", "text": "Congo", "customs_declaration_required": true}, {"id": "CK", "text": "Cookøerne", "customs_declaration_required": true}, {
    "id": "CR",
    "text": "Costa Rica",
    "customs_declaration_required": true
}, {"id": "CU", "text": "Cuba", "customs_declaration_required": true}, {"id": "CY", "text": "Cypern", "customs_declaration_required": false}, {
    "id": "DK",
    "text": "Danmark",
    "customs_declaration_required": false
}, {"id": "VE", "text": "Den Bolivariske Republik Venezuela", "customs_declaration_required": true}, {
    "id": "CD",
    "text": "Den Demokratiske Republik Congo",
    "customs_declaration_required": true
}, {"id": "DJ", "text": "Djibouti", "customs_declaration_required": true}, {"id": "DM", "text": "Dominica", "customs_declaration_required": true}, {
    "id": "DO",
    "text": "Dominikanske Republik",
    "customs_declaration_required": true
}, {"id": "EC", "text": "Ecuador", "customs_declaration_required": true}, {"id": "EG", "text": "Egypten", "customs_declaration_required": true}, {
    "id": "CI",
    "text": "Elfenbenskysten",
    "customs_declaration_required": true
}, {"id": "SV", "text": "El Salvador", "customs_declaration_required": true}, {"id": "ER", "text": "Eritrea", "customs_declaration_required": true}, {
    "id": "EE",
    "text": "Estland",
    "customs_declaration_required": false
}, {"id": "ET", "text": "Etiopien", "customs_declaration_required": true}, {"id": "FO", "text": "Færøerne", "customs_declaration_required": true}, {
    "id": "FK",
    "text": "Falklandsøerne (Malvinas)",
    "customs_declaration_required": true
}, {"id": "FJ", "text": "Fiji", "customs_declaration_required": true}, {"id": "PH", "text": "Filippinerne", "customs_declaration_required": true}, {
    "id": "FI",
    "text": "Finland",
    "customs_declaration_required": false
}, {"id": "AE", "text": "Forenede Arabiske Emirater", "customs_declaration_required": true}, {
    "id": "FR",
    "text": "Frankrig",
    "customs_declaration_required": false
}, {"id": "GF", "text": "Fransk Guinea", "customs_declaration_required": true}, {
    "id": "PF",
    "text": "Fransk Polynesien",
    "customs_declaration_required": true
}, {"id": "GA", "text": "Gabon", "customs_declaration_required": true}, {"id": "GM", "text": "Gambia", "customs_declaration_required": true}, {
    "id": "GE",
    "text": "Georgien",
    "customs_declaration_required": true
}, {"id": "GH", "text": "Ghana", "customs_declaration_required": true}, {"id": "GI", "text": "Gibraltar", "customs_declaration_required": true}, {
    "id": "GR",
    "text": "Grækenland",
    "customs_declaration_required": false
}, {"id": "GD", "text": "Grenada", "customs_declaration_required": true}, {"id": "GL", "text": "Grønland", "customs_declaration_required": true}, {
    "id": "GP",
    "text": "Guadeloupe",
    "customs_declaration_required": true
}, {"id": "GU", "text": "Guam", "customs_declaration_required": true}, {"id": "GT", "text": "Guatemala", "customs_declaration_required": true}, {
    "id": "GG",
    "text": "Guernsey",
    "customs_declaration_required": true
}, {"id": "GN", "text": "Guinea", "customs_declaration_required": true}, {"id": "GW", "text": "Guinea-Bissau", "customs_declaration_required": true}, {
    "id": "GY",
    "text": "Guyana",
    "customs_declaration_required": true
}, {"id": "HT", "text": "Haiti", "customs_declaration_required": true}, {"id": "NL", "text": "Holland", "customs_declaration_required": false}, {
    "id": "HN",
    "text": "Honduras",
    "customs_declaration_required": true
}, {"id": "HK", "text": "Hong Kong", "customs_declaration_required": true}, {"id": "BY", "text": "Hviderusland", "customs_declaration_required": true}, {
    "id": "IN",
    "text": "Indien",
    "customs_declaration_required": true
}, {"id": "ID", "text": "Indonesien", "customs_declaration_required": true}, {"id": "IQ", "text": "Irak", "customs_declaration_required": true}, {
    "id": "IR",
    "text": "Iran, Den Islamiske Republik",
    "customs_declaration_required": true
}, {"id": "IE", "text": "Irland", "customs_declaration_required": false}, {"id": "IS", "text": "Island", "customs_declaration_required": true}, {
    "id": "IL",
    "text": "Israel",
    "customs_declaration_required": true
}, {"id": "IT", "text": "Italien", "customs_declaration_required": false}, {"id": "JM", "text": "Jamaica", "customs_declaration_required": true}, {
    "id": "JP",
    "text": "Japan",
    "customs_declaration_required": true
}, {"id": "JE", "text": "Jersey", "customs_declaration_required": true}, {"id": "JO", "text": "Jordan", "customs_declaration_required": true}, {
    "id": "CV",
    "text": "Kap Verde",
    "customs_declaration_required": true
}, {"id": "KZ", "text": "Kasakhstan", "customs_declaration_required": true}, {"id": "KE", "text": "Kenya", "customs_declaration_required": true}, {
    "id": "CN",
    "text": "Kina",
    "customs_declaration_required": true
}, {"id": "KG", "text": "Kirgisistan", "customs_declaration_required": true}, {"id": "KI", "text": "Kiribati", "customs_declaration_required": true}, {
    "id": "KP",
    "text": "Korea, Den Demokratiske Folkerepublik",
    "customs_declaration_required": true
}, {"id": "KR", "text": "Korea, Republikken", "customs_declaration_required": true}, {"id": "HR", "text": "Kroatien", "customs_declaration_required": false}, {
    "id": "KW",
    "text": "Kuwait",
    "customs_declaration_required": true
}, {"id": "LA", "text": "Lao, Folkets Demokratiske Republik", "customs_declaration_required": true}, {
    "id": "LS",
    "text": "Lesotho",
    "customs_declaration_required": true
}, {"id": "LV", "text": "Letland", "customs_declaration_required": false}, {"id": "LB", "text": "Libanon", "customs_declaration_required": true}, {
    "id": "LR",
    "text": "Liberia",
    "customs_declaration_required": true
}, {"id": "LY", "text": "Libyen", "customs_declaration_required": true}, {"id": "LI", "text": "Liechtenstein", "customs_declaration_required": true}, {
    "id": "LT",
    "text": "Litauen",
    "customs_declaration_required": false
}, {"id": "LU", "text": "Luxemburg", "customs_declaration_required": false}, {"id": "MO", "text": "Macao", "customs_declaration_required": true}, {
    "id": "MG",
    "text": "Madagaskar",
    "customs_declaration_required": true
}, {"id": "MK", "text": "Makedonien, Republikken", "customs_declaration_required": true}, {
    "id": "MW",
    "text": "Malawi",
    "customs_declaration_required": true
}, {"id": "MY", "text": "Malaysia", "customs_declaration_required": true}, {"id": "MV", "text": "Maldiverne", "customs_declaration_required": true}, {
    "id": "ML",
    "text": "Mali",
    "customs_declaration_required": true
}, {"id": "MT", "text": "Malta", "customs_declaration_required": false}, {"id": "MA", "text": "Marokko", "customs_declaration_required": true}, {
    "id": "MH",
    "text": "Marshalløerne",
    "customs_declaration_required": true
}, {"id": "MQ", "text": "Martinique", "customs_declaration_required": true}, {"id": "MR", "text": "Mauretanien", "customs_declaration_required": true}, {
    "id": "MU",
    "text": "Mauritius",
    "customs_declaration_required": true
}, {"id": "YT", "text": "Mayotte", "customs_declaration_required": true}, {"id": "MX", "text": "Mexico", "customs_declaration_required": true}, {
    "id": "FM",
    "text": "Mikronesiens Forenede Stater",
    "customs_declaration_required": true
}, {"id": "MZ", "text": "Mocambique", "customs_declaration_required": true}, {
    "id": "MD",
    "text": "Moldova, Republikken",
    "customs_declaration_required": true
}, {"id": "MC", "text": "Monaco", "customs_declaration_required": true}, {"id": "MN", "text": "Mongoliet", "customs_declaration_required": true}, {
    "id": "ME",
    "text": "Montenegro",
    "customs_declaration_required": true
}, {"id": "MS", "text": "Montserrat", "customs_declaration_required": true}, {"id": "NA", "text": "Namibia", "customs_declaration_required": true}, {
    "id": "NR",
    "text": "Nauru",
    "customs_declaration_required": true
}, {"id": "NP", "text": "Nepal", "customs_declaration_required": true}, {"id": "NZ", "text": "New Zealand", "customs_declaration_required": true}, {
    "id": "NI",
    "text": "Nicaragua",
    "customs_declaration_required": true
}, {"id": "NE", "text": "Niger", "customs_declaration_required": true}, {"id": "NG", "text": "Nigeria", "customs_declaration_required": true}, {
    "id": "NU",
    "text": "Niue",
    "customs_declaration_required": true
}, {"id": "MP", "text": "Nordmarianerne", "customs_declaration_required": true}, {"id": "NO", "text": "Norge", "customs_declaration_required": true}, {
    "id": "NC",
    "text": "Ny Kaledonien",
    "customs_declaration_required": true
}, {"id": "OM", "text": "Oman", "customs_declaration_required": true}, {"id": "AT", "text": "Østrig", "customs_declaration_required": false}, {
    "id": "PK",
    "text": "Pakistan",
    "customs_declaration_required": true
}, {"id": "PW", "text": "Palau", "customs_declaration_required": true}, {"id": "PA", "text": "Panama", "customs_declaration_required": true}, {
    "id": "PG",
    "text": "Papua Ny Guinea",
    "customs_declaration_required": true
}, {"id": "PY", "text": "Paraguay", "customs_declaration_required": true}, {"id": "PE", "text": "Peru", "customs_declaration_required": true}, {
    "id": "PL",
    "text": "Polen",
    "customs_declaration_required": false
}, {"id": "PT", "text": "Portugal", "customs_declaration_required": false}, {"id": "PR", "text": "Puerto Rico", "customs_declaration_required": true}, {
    "id": "QA",
    "text": "Qatar",
    "customs_declaration_required": true
}, {"id": "RE", "text": "Réunion", "customs_declaration_required": true}, {"id": "RO", "text": "Rumænien", "customs_declaration_required": false}, {
    "id": "RU",
    "text": "Russiske føderation",
    "customs_declaration_required": true
}, {"id": "RW", "text": "Rwanda", "customs_declaration_required": true}, {"id": "SB", "text": "Salomonøerne", "customs_declaration_required": true}, {
    "id": "WS",
    "text": "Samoa",
    "customs_declaration_required": true
}, {"id": "SH", "text": "Sankt Helena, Ascension og Tristan da Cunha", "customs_declaration_required": true}, {
    "id": "KN",
    "text": "Sankt Kitts og Nevis",
    "customs_declaration_required": true
}, {"id": "LC", "text": "Sankt Lucia", "customs_declaration_required": true}, {
    "id": "VC",
    "text": "Sankt Vincent og Grenadinerne",
    "customs_declaration_required": true
}, {"id": "SM", "text": "San Marino", "customs_declaration_required": true}, {
    "id": "ST",
    "text": "São Tomé og Príncipe",
    "customs_declaration_required": true
}, {"id": "SA", "text": "Saudi-Arabien", "customs_declaration_required": true}, {"id": "CH", "text": "Schweiz", "customs_declaration_required": true}, {
    "id": "SN",
    "text": "Senegal",
    "customs_declaration_required": true
}, {"id": "RS", "text": "Serbien", "customs_declaration_required": true}, {"id": "SC", "text": "Seychellerne", "customs_declaration_required": true}, {
    "id": "SL",
    "text": "Sierra Leone",
    "customs_declaration_required": true
}, {"id": "SG", "text": "Singapore", "customs_declaration_required": true}, {"id": "SK", "text": "Slovakiet", "customs_declaration_required": false}, {
    "id": "SI",
    "text": "Slovenien",
    "customs_declaration_required": false
}, {"id": "SO", "text": "Somalia", "customs_declaration_required": true}, {"id": "ES", "text": "Spanien", "customs_declaration_required": false}, {
    "id": "LK",
    "text": "Sri Lanka",
    "customs_declaration_required": true
}, {"id": "GB", "text": "Storbritantien", "customs_declaration_required": false}, {"id": "SD", "text": "Sudan", "customs_declaration_required": true}, {
    "id": "SR",
    "text": "Surinam",
    "customs_declaration_required": true
}, {"id": "SE", "text": "Sverige", "customs_declaration_required": false}, {"id": "SZ", "text": "Swaziland", "customs_declaration_required": true}, {
    "id": "ZA",
    "text": "Sydafrika",
    "customs_declaration_required": true
}, {"id": "SS", "text": "Sydsudan", "customs_declaration_required": true}, {
    "id": "SY",
    "text": "Syriske Arabiske Republik",
    "customs_declaration_required": true
}, {"id": "TJ", "text": "Tadsjikistan", "customs_declaration_required": true}, {"id": "TW", "text": "Taiwan", "customs_declaration_required": true}, {
    "id": "TZ",
    "text": "Tanzania, Den Forenede Republik",
    "customs_declaration_required": true
}, {"id": "TD", "text": "Tchad", "customs_declaration_required": true}, {"id": "TH", "text": "Thailand", "customs_declaration_required": true}, {
    "id": "TL",
    "text": "Timor-Leste",
    "customs_declaration_required": true
}, {"id": "CZ", "text": "Tjekkiet", "customs_declaration_required": false}, {"id": "TG", "text": "Togo", "customs_declaration_required": true}, {
    "id": "TO",
    "text": "Tonga",
    "customs_declaration_required": true
}, {"id": "TT", "text": "Trinidad og Tobago", "customs_declaration_required": true}, {"id": "TN", "text": "Tunesien", "customs_declaration_required": true}, {
    "id": "TC",
    "text": "Turks- og Caicosøerne",
    "customs_declaration_required": true
}, {"id": "TV", "text": "Tuvalu", "customs_declaration_required": true}, {"id": "TR", "text": "Tyrkiet", "customs_declaration_required": true}, {
    "id": "DE",
    "text": "Tyskland",
    "customs_declaration_required": false
}, {"id": "UG", "text": "Uganda", "customs_declaration_required": true}, {"id": "UA", "text": "Ukraine", "customs_declaration_required": true}, {
    "id": "HU",
    "text": "Ungarn",
    "customs_declaration_required": false
}, {"id": "UY", "text": "Uruguay", "customs_declaration_required": true}, {"id": "US", "text": "USA", "customs_declaration_required": true}, {
    "id": "UZ",
    "text": "Usbekistan",
    "customs_declaration_required": true
}, {"id": "VU", "text": "Vanuatu", "customs_declaration_required": true}, {"id": "VN", "text": "Vietnam", "customs_declaration_required": true}, {
    "id": "YE",
    "text": "Yemen",
    "customs_declaration_required": true
}, {"id": "ZM", "text": "Zambia", "customs_declaration_required": true}, {"id": "ZW", "text": "Zimbabwe", "customs_declaration_required": true}];


jQuery(document).ready(function () {
    var initParcelPrices = false;
    var initPalletPrices = false;

    var parcelFromCountryCode = 'DK';
    var parcelToCountryCode = 'DK';


    function scrollToPrices() {
        var el = jQuery('.carrier-prices .parcels');
        if (el) {
            jQuery('html, body').animate({
                scrollTop: el.offset().top - 148
            }, 500);
        }
    }

    function scrollToPalletPrices() {
        var el = jQuery('.carrier-prices .pallets');
        if (el) {
            jQuery('html, body').animate({
                scrollTop: el.offset().top - 148
            }, 500);
        }
    }

    function formatState(state) {
        if (!state.id) {
            return state.text;
        }
        var $state = jQuery(
            '<span class="flag-icon flag-icon-' + state.element.value.toLowerCase() + '"></span> <span>' + state.text + '</span>'
        );
        return $state;
    }

    jQuery(".from-country-parcel").select2({
        templateResult: formatState,
        templateSelection: formatState,
        /*language: "da"*/
        data: window.toCountries,
        language: "da"
    }).on('select2:select', function (evt) {
        if (evt.params && evt.params.data && evt.params.data.id) {

            parcelFromCountryCode = evt.params.data.id;

            loadPrices(parcelFromCountryCode, parcelToCountryCode, evt.params.data.text, true);
            //Only set if changes has been made (not init)
            if (evt.params.data.element) {
                window.location.hash = evt.params.data.id;
            }
        }
    });


    jQuery(".to-country-parcel").select2({
        templateResult: formatState,
        templateSelection: formatState,
        data: window.toCountries,
        language: "da"
    }).on('select2:select', function (evt) {
        if (evt.params && evt.params.data && evt.params.data.id) {
            parcelToCountryCode = evt.params.data.id;

            loadPrices(parcelFromCountryCode, parcelToCountryCode, evt.params.data.text, true);
            //Only set if changes has been made (not init)
            if (evt.params.data.element) {
                window.location.hash = evt.params.data.id;
            }
        }
    });

    jQuery(".from-country-pallet").select2({
        templateResult: formatState,
        templateSelection: formatState,
        language: "da"
    });

    jQuery(".to-country-pallet").select2({
        templateResult: formatState,
        templateSelection: formatState,
        data: window.toCountries,
        language: "da"
    }).on('select2:select', function (evt) {
        if (evt.params && evt.params.data && evt.params.data.id) {
            loadPrices('DK', evt.params.data.id, evt.params.data.text, false);

            if (evt.params.data.element) {
                window.location.hash = evt.params.data.id + 'P';
            }
        }
    });


    function resetCountrySelect() {
        var foundCountry = false;

        for (var i = 0; i < window.toCountries.length; i++) {
            var country = window.toCountries[i];
            if (country.id === 'DK') {
                foundCountry = country;
            }
        }
        if (foundCountry) {
            loadPrices('DK', foundCountry.id, foundCountry, true);
            loadPrices('DK', foundCountry.id, foundCountry, false);
            jQuery(".to-country-parcel").val(foundCountry.id).trigger('change');
            jQuery(".to-country-pallet").val(foundCountry.id).trigger('change');
        }

        /*jQuery(".to-country-parcel").select2("trigger", "select", {
         data: {id: "DK", text: 'Danmark'}
         });
         jQuery(".to-country-pallet").select2("trigger", "select", {
         data: {id: "DK", text: 'Danmark'}
         });*/

        /*jQuery('.carrier-prices').removeClass('hidden');*/
    }

    var hash = window.location.hash;
    if (hash.length == 3) {
        var foundCountry = false;
        var id = hash.replace('#', '');

        for (var i = 0; i < window.toCountries.length; i++) {
            var country = window.toCountries[i];
            if (country.id === id) {
                foundCountry = country;
            }
        }

        if (foundCountry) {
            jQuery(".to-country-parcel").select2("trigger", "select", {
                data: {id: foundCountry.id, text: foundCountry.text}
            });
            jQuery(".to-country-pallet").select2("trigger", "select", {
                data: {id: "DK", text: 'Danmark'}
            });
            setTimeout(function () {
                scrollToPrices();
            }, 300);
        } else {
            resetCountrySelect();
        }
    } else if (hash.length == 4) {
        var foundCountry = false;
        var id = hash.replace('#', '');

        id = id.substring(0, 2); //We could extend to add charactor instead

        for (var i = 0; i < window.toCountries.length; i++) {
            var country = window.toCountries[i];
            if (country.id === id) {
                foundCountry = country;
            }
        }

        if (foundCountry) {
            jQuery(".to-country-pallet").select2("trigger", "select", {
                data: {id: foundCountry.id, text: foundCountry.text}
            });

            jQuery(".to-country-parcel").select2("trigger", "select", {
                data: {id: "DK", text: 'Danmark'}
            });
            setTimeout(function () {
                scrollToPalletPrices();
            }, 1000);
        } else {
            resetCountrySelect();
        }
    } else {
        resetCountrySelect();
    }


    function loadPrices(from, to, country, isParcel) {
        clearAgents(isParcel);

        jQuery.ajax({
            url: "https://app.shipmondo.com/api/v1/quotes.jsonp",
            jsonp: "callback",
            dataType: "jsonp",
            data: {
                sender_country_code: from,
                receiver_country_code: to,
                type: (isParcel) ? 'parcel' : 'pallet',
                format: "json"
            },
            success: function (response) {
                if (response) {
                    for (var key in response) {
                        if (response.hasOwnProperty(key)) {
                            addRatesAndPrices(key, response[key], isParcel);
                        }
                    }
                    if (initParcelPrices && initPalletPrices) {
                        if (isParcel) {
                            setTimeout(function () {
                                scrollToPrices();
                            }, 300);
                        } else {
                            setTimeout(function () {
                                scrollToPalletPrices();
                            }, 300);
                        }
                    } else {
                        if (isParcel) {
                            initParcelPrices = true;

                            /*jQuery('.country-selector-row .col-md-3').show()*/

                        } else {
                            initPalletPrices = true;
                        }
                    }
                }
            }
        });

        function addRatesAndPrices(key, obj, isParcel) {
            var rates = '';
            var products = '';
            var shippingAgentDiv = '';
            if (isParcel) {
                shippingAgentDiv = jQuery(".parcels .shipping-agent." + key);
            } else {
                shippingAgentDiv = jQuery(".pallets .shipping-agent." + key);
            }

            if (obj.rates) {
                shippingAgentDiv.find(".note").show();
                shippingAgentDiv.removeClass('hidden-xs');

                for (i = 0; i < obj.rates.length; i++) {
                    var rate = obj.rates[i];
                    if (rate.price) {
                        rates += '<p>' + rate.description + '<span class="pull-right">' + rate.price + ' kr.</span></p>';
                    } else if (rate.price_from) {
                        if (rate.price_to) {
                            rates += '<p>' + rate.description + '<span class="pull-right">Fra ' + rate.price_from + ' - ' + rate.price_to + ' kr.</span></p>';
                        } else {
                            rates += '<p>' + rate.description + '<span class="pull-right">Fra ' + rate.price_from + ' kr.</span></p>';

                        }
                    }
                }
            } else {
                //Rammer ikke da key ikke findes...V
                rates = '<p class="shipping-not-possible">Forsendelser til ' + country + ' med ' + obj.name + ' er desværre pt. ikke muligt.</p>';
                shippingAgentDiv.find(".note").hide();
                shippingAgentDiv.addClass('hidden-xs');
            }

            if (obj.products) {
                if (obj.products.length > 0) {
                    products = '<p class="headline">Produkter</p>';
                }

                for (i = 0; i < obj.products.length; i++) {
                    var product = obj.products[i];
                    if (product.price) {
                        products += '<p>' + product.description + '<span class="pull-right">' + product.price + ' kr.</span></p>';
                    } else {
                        products += '<p>' + product.description + '</p>';

                    }
                }
            }

            shippingAgentDiv.find(".rates").append(rates);
            shippingAgentDiv.find(".products").append(products);

            if (obj.transit_time) {
                shippingAgentDiv.find(".deliveryTime").append('<p class="headline">Leveringstid</p>');

                if (obj.transit_time === "1") {
                    shippingAgentDiv.find(".deliveryTime").append('<p>' + obj.transit_time + ' hverdag.</p>');
                } else {
                    shippingAgentDiv.find(".deliveryTime").append('<p>' + obj.transit_time + ' hverdage.</p>');
                }
            } else if (obj.transit_time_from) {
                shippingAgentDiv.find(".deliveryTime").append('<p class="headline">Leveringstid</p>');

                if (obj.transit_time_from === "1") {
                    shippingAgentDiv.find(".deliveryTime").append('<p>Fra: ' + obj.transit_time_from + ' hverdag.</p>');
                } else {
                    shippingAgentDiv.find(".deliveryTime").append('<p>Fra: ' + obj.transit_time_from + ' hverdage.</p>');
                }
            }

            if (obj.additional_information) {
                for (i = 0; i < obj.additional_information.length; i++) {
                    shippingAgentDiv.find(".deliveryTime").append('<p>' + obj.additional_information[i] + '</p>');
                }
            }
        }
    }

    function clearAgents(isParcel) {
        //Måske lave fade?
        var allShippingAgents = '';
        if (isParcel) {
            allShippingAgents = jQuery(".parcels .shipping-agent");
        } else {
            allShippingAgents = jQuery(".pallets .shipping-agent");
        }
        allShippingAgents.find(".rates").empty();
        allShippingAgents.find(".products").empty();
        allShippingAgents.find(".deliveryTime").empty();
    }


    jQuery('.carrier-prices .go-to-pallet').click(function () {
        scrollToPalletPrices();
    });
});